function somOfferSiteCatTracking(){var urlParamRegex,ajaxUrlRegex,activeAjaxCalls=0,jqElements=["div","a"],jqParams=["intc","cmp","emc","ecid","icid","cid"],jqAttributes=["onclick","onmousedown","onmouseup","href","data-actionurl"];ajaxUrlRegex=new RegExp(escapeRegExp("/US/REST/manageoffers/getoffers.jws")+"|"+escapeRegExp("/REST/offers/getOffers.jws")+"|"+escapeRegExp("/JRS/som/GetContextualOfferDetails.do")+"|"+escapeRegExp("/JRS/som/GetContextualOfferDetailsForDashboard.do"));urlParamRegex=new RegExp("(^|[? &\"']|%26|%3F|%3f)("+jqParams.join("|")+")(=|%3D|%3d)(.*?)([ &\"']|%26|$)");$(document).ajaxSend(function(e,jqXHR,options){ajaxCallStarted(options.url)});$(document).ajaxComplete(function(e,jqXHR,options){ajaxCallCompleted(options.url)});function ajaxCallStarted(url){if(!url||ajaxUrlRegex.test(url)){activeAjaxCalls++}}function ajaxCallCompleted(url){if(!url||ajaxUrlRegex.test(url)){activeAjaxCalls--;if(activeAjaxCalls<1){$(window).trigger("somAjaxCallsCompleted")}}}function trackCampaignCodeWithCampaignText(campaigntext){var s=window.s||s_gi(s_account),isInternal=false,trackResult,trackParam="",trackCode="";trackResult=urlParamRegex.exec(campaigntext);if(trackResult){trackParam=trackResult[2];trackCode=trackResult[4].replace(");","");if(/^(icid|intc)$/.test(trackParam)){isInternal=true}}if(campaigntext.indexOf("PrepareSSOToBBAction")!==-1){s=s_gi(wa_BB_Acct);s.s_account=wa_BB_Acct}else{if(campaigntext.indexOf("PrepareForSSOToTY")!==-1){s=s_gi(wa_TY_Acct);s.s_account=wa_TY_Acct}else{if(campaigntext.indexOf("citiprivatepass")!==-1){s=s_gi(wa_PP_Acct);s.s_account=wa_PP_Acct}}}if(/^(cmp|emc|ecid|intc|cid)$/.test(trackParam)){s.tQryStrCmp="cbol"}else{if(/^(icid)$/.test(trackParam)){s.tQryStrCmp="cmi"}else{s.tQryStrCmp=""}}if(isInternal){s.linkTrackVars="eVar39";s.eVar39=trackCode}else{s.linkTrackVars="campaign"}if(!isInternal&&s.tQryStrCmp=="cbol"){s.campaign=trackCode}else{if(isInternal&&s.tQryStrCmp=="cmi"){s.linkTrackEvents="event34";if(s.eVar39){s.events="event34"}}}s.trackingServer="metrics.citibank.com";s.trackingServerSecure=wa_siteCat_Domain;s.tl(this,"o",trackCode)}function trackCampaignCode(element){var eventtext="",elementAttrs=[],attrString;for(var attr=0;attr<jqAttributes.length;attr++){attrString=$(element).attr(jqAttributes[attr]);if(attrString){if($(".cT-contextAlert").find(element).length||$("#cardsOfferPanel").find(element).length||$("#benefitsMenu .StructContextualtext").find(element).length||$("#myProfileMenu .StructContextualtext").find(element).length){if(attrString.indexOf("updateSOMForCO(")>0){var splitString=attrString.split("offer_");var firstString=splitString[0];var varString=splitString[1];var endIndex=varString.indexOf(");");var offerVariable=varString.substring(0,endIndex-1);var url=window[offerVariable.toString()];if(url&&url!=""){varString=varString.replace(offerVariable.toString(),url.toString());attrString=firstString+"offer_"+varString}}}elementAttrs.push(attrString)}}if(elementAttrs.length!==0){eventtext=elementAttrs.join(" ");trackCampaignCodeWithCampaignText(eventtext)}}function trackCampaignCodeWithUrl(actionUrl){if(actionUrl){trackCampaignCodeWithCampaignText(actionUrl)}}function startTracking(){var codeRegex,codeTest,codeMatch,jqSelectors=[],$tagsToTrack;for(var attr=0;attr<jqAttributes.length;attr++){for(var pa=0;pa<jqParams.length;pa++){for(var el=0;el<jqElements.length;el++){jqSelectors.push(jqElements[el]+"["+jqAttributes[attr]+"*='"+jqParams[pa]+"=']");jqSelectors.push(jqElements[el]+"["+jqAttributes[attr]+"*='"+jqParams[pa]+"%3D']")}}}jqSelectors.push(".cT-contextAlert a[href*='updateSOMForCO(']");jqSelectors.push("#cardsOfferPanel a[href*='updateSOMForCO(']");jqSelectors.push("#benefitsMenu .StructContextualtext a[href*='updateSOMForCO(']");jqSelectors.push("#myProfileMenu .StructContextualtext a[href*='updateSOMForCO(']");jqSelectors=jqSelectors.join(",");$tagsToTrack=$(jqSelectors);$tagsToTrack.bind("click",function(){trackCampaignCode(this)})}function waitForAjax(){if(activeAjaxCalls>0){$(window).on("somAjaxCallsCompleted",function(){if(jQuery("body[id='acbol_common_t_sDashboard']").length){var intervalID=setInterval(function(){if(jQuery("#mbarWidget").is(":visible")&&!jQuery("#mBarLoadingImgDiv").is(":visible")){clearInterval(intervalID);setTimeout(function(){startTracking()},1000)}},500)}else{setTimeout(function(){startTracking()},1000)}})}else{if(jQuery("body[id='acbol_common_t_sDashboard']").length){var intervalID=setInterval(function(){if(jQuery("#mbarWidget").is(":visible")&&!jQuery("#mBarLoadingImgDiv").is(":visible")){clearInterval(intervalID);setTimeout(function(){startTracking()},1000)}},500)}else{setTimeout(function(){startTracking()},1000)}}}function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return{ajaxCallStarted:ajaxCallStarted,ajaxCallCompleted:ajaxCallCompleted,waitForAjax:waitForAjax,startTracking:startTracking,trackCampaignCodeWithUrl:trackCampaignCodeWithUrl}}var somTrackingObj=somOfferSiteCatTracking();